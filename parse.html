<!DOCTYPE html>
<html>
    <head>
    	<!--<script type="text/javascript" ></script>-->
        <link rel="stylesheet" type="text/css" href="style.css">
        <script type="text/javascript">
		    var mydata = {

		        "chart": {
		            "caption": "Track Test Report",
		            "subcaption": "Report Data",
		            width: 300,
		            height: 200
		        },

		        "data": [

		             {
		                time: "2018-06",
		                yAxis2: 33,
		                yAxis3: 765
		            },
		            {
		                time: "2016-06",
		                yAxis3: 3542
		            },
		             {
		                time: "2015-02",
		                yAxis1: 700,
		                yAxis2: 44
		            }, {
		                time: "2013-05",
		                yAxis1: 31,
		                yAxis2: 526,
		                yAxis3: 93
		            },
		            {
		                time: "2012-06",
		                yAxis1: 1
		            },
		            {
		                time: "2009-05",
		                yAxis1: 3,
		                yAxis2: 256,
		                yAxis3: 683
		            },
		            {
		                time: "2007-05",
		                yAxis1: 51,
		                yAxis2: 5,
		                yAxis3: 953
		            },
		            {
		                time: "2004-05",
		                yAxis1: 69,
		                yAxis4: 956,
		                yAxis3: 3
		            },
		            {
		                time: "2003-05",
		                yAxis1: 11,
		                yAxis2: 560,
		                yAxis3: 953
		            },
{
		                time: "2001-05",
		                yAxis1: 69,
		                yAxis2: 956,
		                yAxis4: 3,
		            },





		        ]
		    };

		    //  console.log(Object.keys(mydata.data));

		    //------getting data in object-------
		    var obj = mydata.data;
		    var dataob = {};
		    for (var key in obj) {
		        var o = obj[key];
		        var temp;
		        for (var key2 in o) {
		            var o22 = o[key2];


		            if (key2 == 'time') {
		                temp = o[key2];
		                //console.log(temp);  
		            } else {
		                //console.log(temp);
		                if (dataob[key2] == undefined) {
		                    dataob[key2] = [];
		                }
		                    dataob[key2].push({
		                        time: temp,
		                        value: o[key2]
		                    });
		                 
		                    

		            }

		        }
		    }


		    //----finding max mins
		    var noOf = Object.keys(dataob).length;
		    //console.log(noOf);
		    var max = Array(noOf).fill(0),
		        min = Array(noOf).fill(1 / 0);

		    var count = 0;
		    var maxx=0,minx=1/0;
		    
		    for (var kk in dataob) {

		        var kx = dataob[kk];
		        //console.log("next");
		        for (var kkk in kx) {
		            var value2 = kx[kkk].value;
		            var time2 = kx[kkk].time;
		            //console.log(time2);
		            var tt=new Date(time2);
		            var yr=tt.getFullYear();
		            var mo=tt.getMonth();
		            var tim=yr*12+mo;
		            //console.log(tim/12);
		            if (tim > maxx)
		            	maxx=tim;

		            if (tim < minx)
		            	minx=tim;

		            if (value2 > max[count]) {
		                max[count] = value2;
		            }
		            if (value2 < min[count]) {
		                min[count] = value2;
		            }

		        }
		        count++;
		    }
		    //console.log(maxx/12,"gggg");
		    //----x axis max mins
		    
		   //console.log(maxx,minx,"abc")

		    //----difference
		    var diffx=maxx-minx;
		    //console.log(diffx);
		    var diff = Array(noOf);

		    for (var i = 0; i < noOf; i++) {
		    	if(max[i] - min[i]!=0)
		    	      diff[i] = (max[i] - min[i]);
		    	  else
		    	  	diff[i] = 1;
		    }
		    //console.log("mins");
		    for (var i = 0; i < noOf; i++) {
		        //console.log(min[i]);
		    }
		    //console.log("maxs");
		    for (var i = 0; i < noOf; i++) {
		        //console.log(max[i]);
		    }

		    //-----optimized max mins------  
		    var min2 = Array(noOf);
		    var max2 = Array(noOf);
		    //console.log("optimized");
		    for (var i = 0; i < noOf; i++) {
		        var term = diff[i] + "";
		        var lent = (term).length;
		        var divmin = 5 * Math.pow(10, (lent - 2));
		        var quot = Math.floor(min[i] / divmin);
		        min2[i] = quot * divmin;
		        //console.log("q"+min2[i]);

		        if (max[i] / diff[i] < 10) {
		            var term2 = min[i] + "";
		            var lent2 = (term2).length;
		            var divmax = 5 * Math.pow(10, (lent2 - 2));
		            if (divmax > divmin)
		                divmin = divmax;
		        }
		        var quot2 = Math.ceil(max[i] / divmin);
		        max2[i] = quot2 * divmin;
		        //console.log("qq"+max2[i]);
		    }
		    //-------y axis divs-----
		    var divisiony = Array(noOf);
		    var ticks = {};
		    for (var i = 0; i < noOf; i++) {
		        var tempp = max[i] + "";
		        var lenm = (tempp).length;
		        var divs = Math.pow(10, (lenm - 2));
		        var opmax = max[i] / divs;
		        var opmin = min[i] / divs;
		        var differ = opmax - opmin;
		        var flag;
		        if (differ <= 1)
		            flag = 0.25;
		        else if (differ <= 3)
		            flag = 0.5;
		        else if (differ <= 6)
		            flag = 1;
		        else if (differ <= 12)
		            flag = 2;
		        else if (differ <= 20)
		            flag = 4;
		        else if (differ <= 30)
		            flag = 5;
		        else if (differ <= 40)
		            flag = 7;
		        else
		            flag = 10;


		        divisiony[i] = flag * divs;

		    }
		    for (var i = 0; i < noOf; i++) {
		        //console.log(divisiony[i]);
		        ticks[i] = [];
		        for (var j = min2[i]; j <= max2[i]; j += divisiony[i])
		            ticks[i].push(j);
		    }
		    
		        //console.log(ticks);

		    

		    //--------Proportionate values--------
		    var ratio = Array(noOf);
		    var obj2 = mydata.chart;
		    var cwidth, cheight;
		    for (var key in obj2) {
		        var oc = obj2[key];

		        if (key == "width") {
		            cwidth = oc;
		        }
		        if (key == "height") {
		            cheight = oc;
		        }

		    }


		    var ratiox=cwidth/6;
		    for(i=0;i<noOf;i++)
		    {
		    	ratio[i]=cheight/ticks[i].length;

		    }
		    //console.log(ratio);

		    </script>
        
    	<title>MultiLine Charts</title>
    </head>
    <body>
        <div id="chart-cont"></div>

        <script type="text/javascript">
        	var svgNS = "http://www.w3.org/2000/svg"; 
           

        	//-calculate coordinates
        	var count=0;
        	var xplot_ratio=cwidth/diffx;var coordinates=Array(noOf).fill("");
        	var coordinatec={};
        	//console.log(diffx);
        	//console.log("width",cwidth,cheight);
			for (var kk in dataob) {
				var yplot_ratio=(cheight-25)/diff[count];
				//console.log(diff[count]);
		        var kx = dataob[kk];
		        //console.log("next",yplot_ratio,"/",xplot_ratio);
		        for (var kkk in kx) {
		            var value2 = kx[kkk].value;
		            var time2 = kx[kkk].time;
		            var tt=new Date(time2);
		            var yr=tt.getFullYear();
		            var mo=tt.getMonth();
		            var tim=yr*12+mo;
		            //console.log(tim-minx);
		            var time_coordinate=60+(tim-minx)*xplot_ratio;
		            //console.log(value2-min[count]);
		            var y_coordinate=cheight+-( (value2-min[count])*yplot_ratio);
		            //console.log(time_coordinate,"^",y_coordinate);
		            var temporary=coordinates[count]+time_coordinate+","+y_coordinate+" ";
		            coordinates[count]=temporary;
		            if (coordinatec[count] == undefined) {
		                    coordinatec[count] = [];
		                }
		            			coordinatec[count].push({
		                        xc: time_coordinate,
		                        yc: y_coordinate
		                    	});
		            		

		        }
		        console.log(coordinatec[count]);
		       	 count++;
		    }







            for(i=0;i<noOf;i++)
            {
            	var id1="mySvg"+i;
            	 var newSvg = document.createElementNS(svgNS,"svg");
            newSvg.setAttributeNS(null,"id",id1);
            newSvg.setAttributeNS(null,"class","graph");
            newSvg.setAttributeNS(null,"role","img");
            newSvg.setAttributeNS(null,"height",(cheight+60));
           // newSvg.setAttributeNS(null,"width",(cwidth+40));

            document.getElementById("chart-cont").appendChild(newSvg);
            
            //--printing y-axis--
            
            var id2="yGrid"+i;
            
            var newG=document.createElementNS(svgNS,"g");
            newG.setAttributeNS(null,"id",id2);
            newG.setAttributeNS(null,"class","grid y-axis");
            document.getElementById(id1).appendChild(newG);

             var newx=document.createElementNS(svgNS,"line");
            newx.setAttributeNS(null,"x1","40");
            newx.setAttributeNS(null,"x2","40");
            newx.setAttributeNS(null,"y1",0);
            newx.setAttributeNS(null,"y2",(cheight+20));
           // heighh+=cheight;
            document.getElementById(id2).appendChild(newx);
            //--printing x axis--
            var id3="xGrid"+i;
            var newG=document.createElementNS(svgNS,"g");
            newG.setAttributeNS(null,"id",id3);
            newG.setAttributeNS(null,"class","grid x-axis");
            document.getElementById(id1).appendChild(newG);

            var newx=document.createElementNS(svgNS,"line");
            newx.setAttributeNS(null,"x1","40");
            newx.setAttributeNS(null,"x2",(cwidth+80));
            newx.setAttributeNS(null,"y1",(cheight+20));
            newx.setAttributeNS(null,"y2",(cheight+20));
            document.getElementById(id3).appendChild(newx);
            //--printing ticks--
            //--y ticks
            var gname="xTicks"+i;
            var newG=document.createElementNS(svgNS,"g");
            newG.setAttributeNS(null,"id",gname);
            newG.setAttributeNS(null,"class","ticks x-ticks");
            document.getElementById(id1).appendChild(newG);

            //var tick2=ticks[i];
            for(var j=0;j<ticks[i].length;j++)
            {
            	
            	//var newtick=tick2[j];
            	var newt=document.createElementNS(svgNS,"line");
            newt.setAttributeNS(null,"x1","36");
            newt.setAttributeNS(null,"x2","40");
            newt.setAttributeNS(null,"y1",(cheight-j*ratio[i]));
            newt.setAttributeNS(null,"y2",(cheight-j*ratio[i]));
            document.getElementById(gname).appendChild(newt);

            }

            //--y divisions
            var gname="xDivs"+i;
            var newG=document.createElementNS(svgNS,"g");
            newG.setAttributeNS(null,"id",gname);
            newG.setAttributeNS(null,"class","division");
            document.getElementById(id1).appendChild(newG);

            //var tick2=ticks[i];
            for(var j=0;j<ticks[i].length;j++)
            {
            	
            	//var newtick=tick2[j];
            	var newt=document.createElementNS(svgNS,"line");
            newt.setAttributeNS(null,"x1","40");
            newt.setAttributeNS(null,"x2",cwidth+80);
            newt.setAttributeNS(null,"y1",(cheight-j*ratio[i]));
            newt.setAttributeNS(null,"y2",(cheight-j*ratio[i]));
            document.getElementById(gname).appendChild(newt);

            }

            
            		//--y labels
            var glabel="yLabels"+i;
            var newG=document.createElementNS(svgNS,"g");
            newG.setAttributeNS(null,"id",glabel);
            newG.setAttributeNS(null,"class","labels y-labels");
            document.getElementById(id1).appendChild(newG);

            var tick2=ticks[i];
            for(var j=0;j<ticks[i].length;j++)
            {
            	
            	var newtick=tick2[j];
            	var newt=document.createElementNS(svgNS,"text");
           	 newt.setAttributeNS(null,"x","30");
            newt.setAttributeNS(null,"y",(cheight-j*ratio[i]));
          	var textNode = document.createTextNode(newtick);
			newt.appendChild(textNode);
            document.getElementById(glabel).appendChild(newt);

            }
        	
             //--x ticks
            var gname2="yTicks"+i;
            var newG=document.createElementNS(svgNS,"g");
            newG.setAttributeNS(null,"id",gname2);
            newG.setAttributeNS(null,"class","ticks x-ticks");
            document.getElementById(id1).appendChild(newG);

            
            for(var j=0;j<=6;j++)
            {
            	
            	
            	var newt=document.createElementNS(svgNS,"line");
            newt.setAttributeNS(null,"x1",60+(ratiox*j));
            newt.setAttributeNS(null,"x2",60+(ratiox*j));
            newt.setAttributeNS(null,"y1",(cheight+20));
            newt.setAttributeNS(null,"y2",(cheight+25));
            document.getElementById(gname2).appendChild(newt);

            }
            if(i==noOf-1)
            {
            //--x labels
            var glabel2="xLabels"+i;
            var newG=document.createElementNS(svgNS,"g");
            newG.setAttributeNS(null,"id",glabel2);
            newG.setAttributeNS(null,"class","labels x-labels");
            document.getElementById(id1).appendChild(newG);

            console.log("xxxxx");
            for(var j=0;j<=6;j++)
            {
            	
            	var newxlabel=minx+((j)*Math.ceil(diffx/6));
            	var monx =newxlabel%12;
            	var yrx=Math.floor(newxlabel/12);
            	var labelx=monx+"/"+yrx;
            	// console.log(monx,"--",yrx);
            	var newt=document.createElementNS(svgNS,"text");
            newt.setAttributeNS(null,"x",60+(ratiox*j));
            newt.setAttributeNS(null,"y",(cheight+40));
          	var textNode = document.createTextNode(labelx);
			newt.appendChild(textNode);
            document.getElementById(glabel2).appendChild(newt);

            }
            var newxlabel="Time";
            var newt=document.createElementNS(svgNS,"text");
            newt.setAttributeNS(null,"x",(cwidth/2)+40);
            newt.setAttributeNS(null,"y",cheight+55);
            newt.setAttributeNS(null,"class","label-title");
            var textNode = document.createTextNode(newxlabel);
            newt.appendChild(textNode);
            document.getElementById(glabel2).appendChild(newt);
       		 }	




            //----plot
            var newp=document.createElementNS(svgNS,"polyline");
            var text_co=coordinates[i];
            newp.setAttributeNS(null,"stroke","#64B5F6");
            newp.setAttributeNS(null,"stroke-width","1");
            newp.setAttributeNS(null,"fill","none");
            newp.setAttributeNS(null,"points",text_co);
            newp.setAttributeNS(null,"id","neww");

           // heighh+=cheight;
            document.getElementById(id1).appendChild(newp);


            var gnamec="circles"+i;
            var newG=document.createElementNS(svgNS,"g");
            newG.setAttributeNS(null,"id",gnamec);
            newG.setAttributeNS(null,"class","circles");
            document.getElementById(id1).appendChild(newG);

            
            	var o=coordinatec[i];
            	for(var c2 in o)
            	{
            		var p=o[c2];


            		var newc=document.createElementNS(svgNS,"circle");
            newc.setAttributeNS(null,"cx",p.xc);
            newc.setAttributeNS(null,"cy",p.yc);
            newc.setAttributeNS(null,"r","2");
            
            document.getElementById(gnamec).appendChild(newc);

            	}
            
           // console.log(o);



			}

            

        </script>
    </body>
</html>
